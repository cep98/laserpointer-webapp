<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Admin-Panel</title>
  <style>
    body {
      background: #111; color: #eee;
      font-family: sans-serif; padding: 20px;
    }
    .status {
      margin-bottom: 20px;
      font-size: 1.2rem;
    }
    label, input {
      display: block; margin: 10px 0;
    }
    input[type=number], input[type=range] {
      width: 100%; max-width: 300px;
    }
    button {
      padding: 10px 20px; background: red;
      color: white; border:none; cursor:pointer;
      font-size: 1rem;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="status">
    Display-Status:
    <span id="display-status" style="color:orange">unbekannt</span>
  </div>

  <label>Max. Winkel horizontal (°):
    <input type="number" id="horiz" value="20" />
  </label>

  <label>Max. Winkel vertikal (°):
    <input type="number" id="vert" value="20" />
  </label>

  <label>Glättung (%):
    <input type="range" id="smooth" min="0" max="100" value="15" />
  </label>

  <label>Minimale Strichstärke (px):
    <input type="number" id="minW" min="1" max="100" value="5" />
  </label>

  <label>Maximale Strichstärke (px):
    <input type="number" id="maxW" min="1" max="100" value="12" />
  </label>

  <button id="clear">Canvas löschen</button>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    // als Admin vorstellen
    socket.emit("identify", { role: "admin", deviceId: null });

    // Anzeige-Element
    const statusEl = document.getElementById("display-status");

    // wenn Display sich verbindet / trennt
    socket.on("display-status", ({connected}) => {
      statusEl.textContent = connected ? "verbunden" : "nicht verbunden";
      statusEl.style.color = connected ? "lightgreen" : "crimson";
    });

    // Eingaben aus Admin
    function sendSettings() {
      const maxH   = parseFloat(horiz.value);
      const maxV   = parseFloat(vert.value);
      const smooth = parseFloat(smooth.value) / 100;
      const minW   = parseFloat(minW_input.value);
      const maxW   = parseFloat(maxW_input.value);

      socket.emit("admin-settings", {
        maxH, maxV, smooth, minW, maxW
      });
    }

    const horiz      = document.getElementById("horiz");
    const vert       = document.getElementById("vert");
    const smooth     = document.getElementById("smooth");
    const minW_input = document.getElementById("minW");
    const maxW_input = document.getElementById("maxW");

    [horiz, vert, smooth, minW_input, maxW_input].forEach(el => {
      el.addEventListener(el.type==="range"?"input":"change", sendSettings);
    });

    document.getElementById("clear").addEventListener("click", () => {
      socket.emit("clear");
    });

    // initial senden
    sendSettings();
  </script>
</body>
</html>
