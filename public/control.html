<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Control v3.2</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { margin: 0; background: #111; color: white; font-family: sans-serif; }
    #drawarea { position: absolute; top: 100px; left: 50%; transform: translateX(-50%); width: 300px; height: 300px; border: 2px solid white; }
    #laserBtn { position: absolute; bottom: 20%; left: 50%; transform: translateX(-50%); width: 120px; height: 120px; background: red; border-radius: 60px; display: none; }
    #controls { position: absolute; top: 10px; left: 10px; display: flex; gap: 10px; }
    .color { width: 30px; height: 30px; border-radius: 50%; border: 2px solid white; }
    #toggleBtn { position: absolute; top: 10px; right: 10px; }
    #version { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); font-size: 14px; }
  </style>
</head>
<body>
  <div id="controls">
    <div class="color" style="background:red" onclick="setColor('red')"></div>
    <div class="color" style="background:green" onclick="setColor('green')"></div>
    <div class="color" style="background:blue" onclick="setColor('blue')"></div>
    <div class="color" style="background:yellow" onclick="setColor('yellow')"></div>
  </div>
  <div id="toggleBtn">Touch</div>
  <div id="version">v3.2</div>
  <div id="drawarea"></div>
  <button id="laserBtn"></button>

  <script>
    const socket = io();
    const drawarea = document.getElementById("drawarea");
    const laserBtn = document.getElementById("laserBtn");
    const toggleBtn = document.getElementById("toggleBtn");
    let mode = "touch";
    let color = "red";

    toggleBtn.onclick = () => {
      mode = (mode === 'touch' ? 'motion' : 'touch');
      toggleBtn.textContent = (mode === 'touch' ? 'Touch' : 'Motion');
      laserBtn.style.display = (mode === 'motion' ? 'block' : 'none');
      drawarea.style.display = (mode === 'touch' ? 'block' : 'none');
    };

    function setColor(c) {
      color = c;
    }

    drawarea.addEventListener("touchmove", e => {
      if (mode !== 'touch') return;
      const touch = e.touches[0];
      const rect = drawarea.getBoundingClientRect();
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;
      socket.emit("draw", { x: x * 2, y: y * 2, color });
    });

    laserBtn.addEventListener("touchstart", e => {
      e.preventDefault();
    });
    laserBtn.addEventListener("touchend", e => {
      e.preventDefault();
    });
  </script>
</body>
</html>
