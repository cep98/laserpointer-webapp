<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Laser Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background: black; margin: 0; overflow: hidden; font-family: sans-serif; color: white; text-align: center; }
        #canvasBox { position: relative; margin: 0 auto; border: 2px dashed grey; width: 90vmin; height: 90vmin; }
        .color-button { width: 30px; height: 30px; border-radius: 50%; border: 2px solid black; display: inline-block; cursor: pointer; }
        #drawButton { width: 100px; height: 100px; border-radius: 50%; background: red; color: white; border: none; font-size: 1.2em; margin-top: 20px; }
    </style>
</head>
<body>
    <h2>Laserpointer Steuerung</h2>
    <div>
        <div class="color-button" style="background:red;" onclick="setColor('red')"></div>
        <div class="color-button" style="background:green;" onclick="setColor('green')"></div>
        <div class="color-button" style="background:blue;" onclick="setColor('blue')"></div>
        <div class="color-button" style="background:yellow;" onclick="setColor('yellow')"></div>
    </div>
    <div id="canvasBox"></div>
    <button id="drawButton">Laser</button>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let color = 'red';
        let isDrawing = false;
        let x = 150, y = 150;

        function setColor(c) { color = c; }

        const box = document.getElementById('canvasBox');
        const drawButton = document.getElementById('drawButton');

        drawButton.addEventListener('touchstart', () => isDrawing = true);
        drawButton.addEventListener('touchend', () => isDrawing = false);

        window.addEventListener('devicemotion', event => {
            const ax = event.accelerationIncludingGravity.x || 0;
            const ay = event.accelerationIncludingGravity.y || 0;

            // Richtung anpassen
            x += ax * 2;
            y += -ay * 2;

            // Begrenzung auf das Quadrat
            x = Math.max(0, Math.min(x, box.offsetWidth));
            y = Math.max(0, Math.min(y, box.offsetHeight));

            if (isDrawing) {
                socket.emit('draw', { x: x / box.offsetWidth, y: y / box.offsetHeight, color });
            }
        });
    </script>
</body>
</html>
