<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Laser Control</title>
  <style>
    body { background: white; font-family: sans-serif; text-align: center; margin: 2em; }
    button, .color { margin: 0.5em; padding: 1em; font-size: 1em; }
    .color { display: inline-block; width: 40px; height: 40px; border-radius: 50%; border: 2px solid black; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Laserpointer Steuerung (Debug)</h1>
  <div>
    <div class="color" style="background:red;" data-color="red"></div>
    <div class="color" style="background:green;" data-color="green"></div>
    <div class="color" style="background:blue;" data-color="blue"></div>
    <div class="color" style="background:yellow;" data-color="yellow"></div>
    <div class="color" style="background:magenta;" data-color="magenta"></div>
    <div class="color" style="background:cyan;" data-color="cyan"></div>
    <div class="color" style="background:white;" data-color="white"></div>
    <div class="color" style="background:black;" data-color="black"></div>
  </div>
  <p><button id="modeBtn">Modus: Touch</button></p>
  <p id="status">Aktiver Modus: Touch</p>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const socket = io();
    let useGyro = false;
    let color = 'red';
    let status = document.getElementById("status");

    document.querySelectorAll(".color").forEach(el => {
      el.onclick = () => {
        color = el.dataset.color;
      };
    });

    document.getElementById("modeBtn").onclick = () => {
      useGyro = !useGyro;
      status.textContent = "Aktiver Modus: " + (useGyro ? "Gyro" : "Touch");
    };

    if (window.DeviceOrientationEvent) {
      window.addEventListener("deviceorientation", e => {
        if (!useGyro) return;
        let x = ((e.gamma + 90) / 180) * window.innerWidth;
        let y = ((e.beta + 90) / 180) * window.innerHeight;
        console.log("sending draw data", {x, y, color});
        socket.emit("draw", { x, y, color });
      });
    }

    window.addEventListener("touchmove", e => {
      if (useGyro) return;
      let t = e.touches[0];
      let x = t.clientX;
      let y = t.clientY;
      console.log("sending draw data", {x, y, color});
      socket.emit("draw", { x, y, color });
    });
  </script>
</body>
</html>
